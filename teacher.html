<!DOCTYPE HTML>
<html>
	<head>
	   <link rel="stylesheet" href="lib/bootstrap/css/bootstrap.css" />
		<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
		<style>
		  body{
			padding-top: 60px;
		  }
		  td {
			text-align: center;
		  }
		</style>
		<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
		<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
		<script type="text/javascript">
			
			function clearConsole() {
				webSocket.send("CLEAR");
				$('#students3').text("");
			}
			var webSocket ;
			function connect() {
				 webSocket = new WebSocket("ws://netgear.rohidekar.com:8082/");
				 //webSocket = new WebSocket("ws://localhost:8082/");
				 webSocket.onopen = function() {
					// TODO: populate with people who've already raised their hand
				 };
				 webSocket.onmessage = function (evt) { 
					var received_msg = evt.data;
					if (received_msg.substring(0,1) == "{") {
						// Add a switch statement on obj.operation
						// the new case will do something like this:
						/*
							To edit the correct count, thistry this:
							
							var tableRow = $("td").filter(function() {
							return $(this).text() == "foo";
							}).closest("tr");
							
							http://stackoverflow.com/questions/6135665/jquery-find-table-row-containing-table-cell-containing-specific-text
						*/
						var obj = jQuery.parseJSON(received_msg);
						var name = obj.name;
						if (obj.operation == 'UPDATE_RAISED_ROW') {
							$("#" + name + "-raised").text(obj.raised);
							$("#" + name + "-correct").text(obj.correct);
						} else if (obj.operation == 'INSERT_RAISED_ROW') {
							$("#students3").append('<tr><td align=center id="'+name+'">'
								+ name + "</td><td id='"+name+"-raised'>" + obj.raised + '</td>'
								+ "<td id='" +name+"-correct'>" + obj.correct + '</td>'
								+ '<td><input id="credit" type="number" style="width:30px" value="1"></td>'
								+ '<td align=center><input id="submit_1" type="button" class="btn" value="Update" onclick="correct(\''+name+'\')"></td></tr>');
						}
					}
					if (received_msg.substring(0,7) == 'RAISE::') {
						var name = received_msg.substring(7, received_msg.length)
					}
				 };
				 webSocket.onclose = function() {			 
					webSocket.send("TEACHER_LEFT");
				 };
			}
			function correct(name) {
				webSocket.send("CORRECT::" + name + "::" + $("#credit").val());
			}
		</script>
	</head>
	<body onload="connect()">
		<div id="output" value=""></div>
		<div class="navbar navbar-inverse navbar-fixed-top">
		  <div class="navbar-inner">
			<div class="container">
			  <h4 style="font-size:18px;" class="pagination-centered">Class Participation Tracker</h4>
			</div>
		  </div>
		</div>   
		
		<center><input type="button" value="clear" onclick="clearConsole()">
		<br>
		<br>
		<br>
		<table id="students3" width="50%">
			<tr><th width="20%">Student</th><th width="20%">Raised Hand</th><th width="20%">Correctly Answered</th><th width="20%">4</th><th width="20%">5</th></tr>
		</table>
		</center>
	</body>
</html>